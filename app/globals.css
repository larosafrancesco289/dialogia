@import 'tailwindcss';
@import '../styles/tokens.css';
@import '../styles/francesco-bootstrap.css';

#__next {
  height: 100%;
}

:root {
  --keyboard-offset: 0px;
  --composer-height: 0px;
  --viewport-height: 100dvh;
  --viewport-offset-top: 0px;
  --viewport-offset-bottom: 0px;
}

@media (max-width: 640px) {
  html,
  body {
    overflow: auto;
  }

  html.keyboard-active,
  html.keyboard-active body {
    overflow: hidden;
  }
}

/* Semantic color helpers (Tailwind-like names mapped to tokens) */
.bg-surface {
  background-color: var(--color-surface);
}
.bg-muted {
  background-color: var(--color-muted);
}
.bg-canvas {
  background-color: var(--color-canvas);
}
.text-fg {
  color: var(--color-fg);
}
.text-fg-muted,
.text-muted-foreground {
  color: var(--color-fg-muted);
}
.border-border {
  border-color: var(--color-border);
}

/* App layout helpers */
.app-shell {
  --header-height: 56px;
  display: grid;
  grid-template-columns: var(--sidebar-width, 320px) 1fr;
  height: var(--viewport-height);
  min-height: var(--viewport-height);
  position: relative;
  column-gap: var(--space-3);
  padding: var(--space-2);
}

.sidebar {
  overflow: hidden;
}

.content {
  overflow: hidden;
  position: relative;
  display: flex;
  flex-direction: column;
}

/* Unified header bar to keep borders aligned across sidebar and content */
.app-header {
  min-height: calc(var(--header-height) + env(safe-area-inset-top));
  padding-top: calc(env(safe-area-inset-top) + var(--space-1));
  padding-bottom: var(--space-1);
  padding-left: var(--space-4);
  padding-right: var(--space-4);
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--space-2);
  row-gap: var(--space-2);
  position: sticky;
  /* Keep flush with the top for maximum headroom */
  top: 0;
  margin: 0 var(--space-2) var(--space-2);
  z-index: 30;
  background: var(--glass-surface-bg);
  -webkit-backdrop-filter: var(--glass-saturate) var(--glass-blur-surface);
  backdrop-filter: var(--glass-saturate) var(--glass-blur-surface);
  border: 1px solid var(--color-border);
  border-radius: 18px;
  box-shadow: var(--shadow-1);
}
@media (max-width: 640px) {
  .app-header {
    margin: var(--space-1);
    padding-left: var(--space-2);
    padding-right: var(--space-2);
    padding-bottom: calc(var(--space-1) + 2px);
    gap: var(--space-1);
    row-gap: var(--space-1);
    border-radius: 14px;
  }
}

@media (max-width: 640px) {
  .mobile-app-bar {
    position: sticky;
    top: 0;
    z-index: 45;
    margin: var(--space-1);
    margin-bottom: var(--space-2);
    padding: calc(env(safe-area-inset-top) + var(--space-1)) var(--space-2) var(--space-2);
    border-radius: 16px;
    background: var(--glass-panel-bg);
    -webkit-backdrop-filter: var(--glass-saturate) blur(16px);
    backdrop-filter: var(--glass-saturate) blur(16px);
    border: 1px solid var(--color-border);
    box-shadow: var(--shadow-card);
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
  }
  .mobile-app-bar-grid {
    display: grid;
    grid-template-columns: auto 1fr auto;
    align-items: center;
    gap: var(--space-2);
  }
  .mobile-app-bar-center {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 6px;
    min-width: 0;
  }
  .mobile-app-bar-title {
    max-width: 100%;
    text-align: center;
    font-weight: 600;
    font-size: 1.05rem;
    line-height: 1.2;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .mobile-model-trigger {
    width: 100%;
  }
  .mobile-model-trigger > button {
    width: 100%;
    height: 36px;
    padding: 0 var(--space-3);
    border-radius: 999px;
    background: color-mix(in oklab, var(--color-surface) 88%, transparent);
    border: 1px solid color-mix(in oklab, var(--color-border) 65%, transparent);
    box-shadow: var(--shadow-1);
  }
  .mobile-model-trigger > button:hover {
    background: color-mix(in oklab, var(--color-muted) 85%, transparent);
  }
  .mobile-model-trigger > button:focus-visible {
    box-shadow: 0 0 0 2px var(--focus-ring);
  }
  .mobile-model-trigger > button .truncate {
    font-weight: 600;
  }
  .mobile-app-bar .icon-button {
    height: 36px;
    width: 36px;
  }
}

/* Slim shimmer bar shown only while waiting for first token */
.header-activity {
  position: absolute;
  left: 10px;
  right: 10px;
  top: 6px;
  height: 2px;
  border-radius: 2px;
  overflow: hidden;
  background: color-mix(in oklab, var(--color-border) 70%, transparent);
  opacity: 0;
  transition: opacity var(--duration-fast) var(--ease-standard);
}
.header-activity.is-active {
  opacity: 1;
}
.header-activity.is-active::before {
  content: '';
  position: absolute;
  left: -30%;
  top: 0;
  bottom: 0;
  width: 30%;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0),
    color-mix(in oklab, var(--color-accent) 65%, transparent),
    rgba(255, 255, 255, 0)
  );
  animation: header-shimmer 1.2s linear infinite;
}

.tutor-model-pill {
  display: inline-flex;
  align-items: center;
  gap: var(--space-3);
  padding: calc(var(--space-2) + 2px) calc(var(--space-4) + 2px);
  border-radius: 999px;
  background: color-mix(in oklab, var(--color-muted) 78%, transparent);
  border: 1px solid color-mix(in oklab, var(--color-border) 80%, transparent);
  box-shadow: var(--shadow-1);
}
.tutor-model-pill__icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 34px;
  height: 34px;
  border-radius: 50%;
  background: color-mix(in oklab, var(--color-accent) 20%, transparent);
  border: 1px solid color-mix(in oklab, var(--color-border) 75%, transparent);
  box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--color-accent) 18%, transparent);
  color: var(--color-accent);
}
.tutor-model-pill__icon svg {
  width: 18px;
  height: 18px;
}
.tutor-model-pill__text {
  display: flex;
  flex-direction: column;
  line-height: 1.15;
  min-width: 0;
}
.tutor-model-pill__label {
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  color: var(--color-fg-muted);
}
.tutor-model-pill__model {
  font-size: 1rem;
  font-weight: 600;
  color: var(--color-fg);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

@media (max-width: 640px) {
  .tutor-model-pill {
    padding: var(--space-2) var(--space-3);
    gap: var(--space-2);
  }
  .tutor-model-pill__icon {
    width: 30px;
    height: 30px;
  }
  .tutor-model-pill__model {
    font-size: 0.95rem;
  }
}
@keyframes header-shimmer {
  0% {
    transform: translateX(0%);
  }
  100% {
    transform: translateX(330%);
  }
}

/* Removed rigid full-width header divider for a softer look */
/* .app-shell::after { } */
/* Minimal icon button for floating controls */
.icon-button {
  height: 28px;
  width: 28px;
  border-radius: 9999px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border: 1px solid var(--color-border);
  background: color-mix(in oklab, var(--color-surface) 85%, transparent);
  color: var(--color-fg);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
}
.icon-button:hover {
  background: var(--color-muted);
}
.icon-button:focus-visible {
  box-shadow: 0 0 0 2px var(--focus-ring);
}
.icon-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Sidebar header actions spacing */
.app-header .traffic-lights + .font-semibold {
  margin-left: 2px;
}

/* Rotate settings gear when drawer is open */
button[aria-label='Open settings'][aria-pressed='true'] > svg {
  transform: rotate(90deg);
  transition: transform 200ms ease;
}

/* Make header icon buttons feel like soft chips */
.app-header .btn-ghost {
  height: var(--control-md);
  padding: 0 var(--space-3);
  border-radius: 9999px;
  background: color-mix(in oklab, var(--color-surface) 65%, transparent);
  border: 1px solid var(--color-border);
  box-shadow: var(--shadow-1);
}
.app-header .btn-ghost:hover {
  background: var(--color-muted);
}
@media (max-width: 640px) {
  .app-header .btn-ghost {
    height: var(--control-sm);
    padding: 0 var(--space-2);
  }
}

.scroll-area {
  overflow: auto;
  /* Contain scroll so Safari doesnâ€™t pan the page when the list hits edges */
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
  /* Prevent browser scroll anchoring from fighting manual autoscroll */
  overflow-anchor: none;
  /* Promote to its own layer to avoid flicker on iOS when glass elements overlap */
  transform: translateZ(0);
  will-change: transform;
  contain: paint;
  touch-action: pan-y; /* allow vertical panning and quick taps */
}

.message-list {
  padding: var(--space-4);
  /* Proper bottom padding since composer is now outside this scroll area */
  padding-bottom: calc(var(--space-6) + var(--keyboard-offset, 0px));
  scroll-padding-bottom: calc(
    var(--space-3) + max(0px, env(safe-area-inset-bottom)) + var(--keyboard-offset, 0px)
  );
}
@media (max-width: 640px) {
  .message-list {
    padding: var(--space-2);
    padding-bottom: calc(var(--space-4) + var(--composer-height, 0px));
    scroll-padding-bottom: calc(
      var(--space-2) + max(0px, env(safe-area-inset-bottom)) + var(--composer-height, 0px)
    );
  }

  html.keyboard-active .message-list {
    padding-bottom: calc(
      var(--space-3) + max(0px, env(safe-area-inset-bottom)) +
        max(0px, calc(var(--composer-height, 0px) - var(--keyboard-offset, 0px)))
    );
    scroll-padding-bottom: calc(
      var(--space-2) + max(0px, env(safe-area-inset-bottom)) +
        max(0px, calc(var(--composer-height, 0px) - var(--keyboard-offset, 0px)))
    );
  }
}

.jump-to-latest {
  position: sticky;
  bottom: calc(
    var(--space-5) + max(10px, env(safe-area-inset-bottom)) + var(--keyboard-offset, 0px)
  );
  display: flex;
  justify-content: flex-end;
  padding-right: calc(var(--space-3) + max(0px, env(safe-area-inset-right)));
  pointer-events: none;
  z-index: 60;
  height: 0;
  overflow: visible;
}
.jump-to-latest__button {
  pointer-events: auto;
  width: 40px;
  height: 40px;
}
@media (max-width: 640px) {
  .jump-to-latest {
    bottom: calc(
      var(--space-6) + max(14px, env(safe-area-inset-bottom)) + var(--composer-height, 0px)
    );
    padding-right: calc(var(--space-1) + max(0px, env(safe-area-inset-right)));
  }

  html.keyboard-active .jump-to-latest {
    bottom: calc(
      var(--space-6) + max(14px, env(safe-area-inset-bottom)) + var(--composer-height, 0px) +
        var(--keyboard-offset, 0px)
    );
  }
}

/* Prevent nested scroll chaining inside drawers/overlays */
.settings-drawer .scroll-area,
.settings-drawer [data-scrollable] {
  overscroll-behavior: contain;
}

.settings-card {
  width: 100%;
  max-width: 720px;
  margin: 0 auto;
}
.settings-card > * + * {
  margin-top: var(--space-4);
}
.settings-card .segmented {
  margin-top: var(--space-2);
}

.settings-actions-stack {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-3);
  align-items: center;
  justify-content: center;
}

.settings-footer {
  position: sticky;
  bottom: 0;
  border-top: 1px solid var(--color-border);
  padding: var(--space-3) var(--space-6);
  padding-bottom: calc(var(--space-3) + max(12px, env(safe-area-inset-bottom)));
  min-height: 72px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: var(--space-3);
}

.settings-save-button {
  min-width: 240px;
  height: calc(var(--control-lg) + 6px);
  font-size: 1.08rem;
  padding: 0 var(--space-6);
}

/* Reusable glass effect */
.glass {
  background: var(--glass-surface-bg);
  -webkit-backdrop-filter: var(--glass-saturate) var(--glass-blur-surface);
  backdrop-filter: var(--glass-saturate) var(--glass-blur-surface);
}

/* Stronger glass for panels/drawers */
.glass-panel {
  background: var(--glass-panel-bg);
  -webkit-backdrop-filter: var(--glass-saturate) var(--glass-blur-panel);
  backdrop-filter: var(--glass-saturate) var(--glass-blur-panel);
}

@media (max-width: 640px) {
  .app-shell {
    grid-template-columns: 1fr; /* collapse grid to one column */
  }
  .app-shell aside.sidebar {
    display: none; /* hide static sidebar column on small screens */
  }
  .app-shell {
    column-gap: var(--space-1);
    padding: var(--space-1);
  }
  .glass {
    -webkit-backdrop-filter: var(--glass-saturate) blur(12px);
    backdrop-filter: var(--glass-saturate) blur(12px);
  }
  .glass-panel,
  .sidebar.bg-surface {
    -webkit-backdrop-filter: var(--glass-saturate) blur(16px);
    backdrop-filter: var(--glass-saturate) blur(16px);
  }
  .app-header {
    margin: var(--space-1);
    padding-left: var(--space-3);
    padding-right: var(--space-3);
    border-radius: 14px;
  }
  /* Make outline buttons smaller in the header (e.g., model picker) */
  .app-header .btn.btn-outline {
    height: var(--control-sm);
    padding: 0 var(--space-3);
  }
  .settings-footer {
    padding: var(--space-2) var(--space-4);
    padding-bottom: calc(var(--space-2) + max(12px, env(safe-area-inset-bottom)));
  }
  .settings-save-button {
    width: 100%;
  }
}

@media (max-width: 640px) {
  /* Swipe affordance: subtle polish for mobile chat rows */
  [data-chat-swipe] .chat-item {
    border-radius: 14px;
    box-shadow: var(--shadow-1);
  }
  [data-chat-swipe] .btn.btn-destructive {
    height: 44px; /* ensure >= 44px */
    min-width: 96px;
  }
}

/* Centered model picker popover on small screens via wrapper */
.model-pop-wrap {
  right: 0; /* default desktop */
}
@media (max-width: 640px) {
  .model-pop-wrap {
    left: 50%;
    right: auto;
    transform: translateX(-50%);
    width: min(560px, calc(100vw - 24px));
  }
  .model-pop-wrap .popover {
    transform-origin: top center; /* nicer animation at center */
  }
}

/* Utility: hide element on mobile, show on >= sm */
.hide-on-mobile {
  display: none !important;
}
@media (min-width: 640px) {
  .hide-on-mobile {
    display: inline-flex !important;
  }
}

/* Settings drawer + overlay animations */
.settings-overlay {
  animation: fade-in 180ms ease-out;
  -webkit-backdrop-filter: blur(2px);
  backdrop-filter: blur(2px);
}
@keyframes fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}
.settings-overlay.is-closing {
  animation: fade-out 160ms ease-in forwards;
}
@keyframes fade-out {
  from {
    opacity: 1;
  }
  to {
    opacity: 0;
  }
}
.settings-drawer {
  animation: drawer-in var(--duration-slow) var(--ease-standard);
  border-top-left-radius: 22px;
  border-bottom-left-radius: 22px;
  overflow-x: hidden; /* allow vertical scrolling while clipping rounded corners */
}
@keyframes drawer-in {
  0% {
    transform: translateX(8%);
    opacity: 0.6;
  }
  70% {
    transform: translateX(-1.5%);
    opacity: 1;
  }
  100% {
    transform: translateX(0%);
    opacity: 1;
  }
}
.settings-drawer.is-closing {
  animation: drawer-out 200ms cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
}
@keyframes drawer-out {
  0% {
    transform: translateX(0%);
    opacity: 1;
  }
  80% {
    transform: translateX(6%);
    opacity: 0.2;
  }
  100% {
    transform: translateX(8%);
    opacity: 0;
  }
}
@media (max-width: 640px) {
  /* Mobile settings: occupy full screen, no rounded edge */
  .settings-drawer {
    border-top-left-radius: 0 !important;
    border-bottom-left-radius: 0 !important;
    border-radius: 0 !important;
  }
  /* Make small utility icon buttons larger for touch */
  .icon-button {
    height: 36px;
    width: 36px;
  }
  /* Prevent iOS text selection popover during long-press on chat rows */
  .chat-item {
    -webkit-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
  }
  /* Re-enable selection inside inline editors */
  .chat-item input,
  .chat-item textarea {
    -webkit-user-select: text;
    user-select: text;
    -webkit-touch-callout: default;
  }
}

.mobile-sheet-overlay {
  position: fixed;
  inset: 0;
  background: rgba(8, 7, 10, 0.42);
  display: flex;
  align-items: flex-end;
  justify-content: center;
  padding: var(--space-2);
  padding-top: calc(env(safe-area-inset-top) + var(--space-6));
  padding-bottom: calc(env(safe-area-inset-bottom) + var(--space-3));
  z-index: 80;
}
.mobile-sheet {
  width: min(100%, 520px);
  border-radius: 22px;
  padding: var(--space-3);
  padding-bottom: var(--space-3);
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
  background: var(--glass-panel-bg);
  -webkit-backdrop-filter: var(--glass-saturate) blur(18px);
  backdrop-filter: var(--glass-saturate) blur(18px);
}
.mobile-sheet-compact {
  padding: var(--space-2) var(--space-2) var(--space-3);
  gap: var(--space-1);
}
.mobile-sheet .icon-button {
  height: 32px;
  width: 32px;
}
.mobile-sheet-handle {
  align-self: center;
  width: 44px;
  height: 4px;
  border-radius: 999px;
  background: color-mix(in oklab, var(--color-border) 70%, transparent);
  margin-bottom: var(--space-2);
}
.mobile-sheet-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: var(--space-2);
}
.mobile-sheet-body {
  max-height: min(70vh, 520px);
  overflow: auto;
  padding-right: 2px;
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}
.mobile-message-sheet-overlay {
  z-index: 110;
  padding: var(--space-3);
  padding-top: calc(env(safe-area-inset-top) + var(--space-6));
  padding-bottom: calc(env(safe-area-inset-bottom) + var(--space-3));
}
.mobile-message-sheet {
  gap: var(--space-3);
  padding: var(--space-3);
  padding-bottom: calc(var(--space-3) + max(0px, env(safe-area-inset-bottom)));
}
.mobile-message-sheet__header {
  display: flex;
  align-items: flex-start;
  gap: var(--space-2);
}
.mobile-message-sheet__title {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.mobile-message-sheet__heading {
  font-size: 0.95rem;
  font-weight: 600;
}
.mobile-message-sheet__preview {
  margin: 0;
  font-size: 0.8rem;
  color: var(--color-fg-muted);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.mobile-message-sheet__actions {
  display: flex;
  flex-direction: column;
  gap: var(--space-2);
}
.mobile-message-action {
  width: 100%;
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-2);
  border-radius: 16px;
  border: 1px solid color-mix(in oklab, var(--color-border) 70%, transparent);
  background: color-mix(in oklab, var(--color-muted) 55%, transparent);
  text-align: left;
  min-height: 56px;
  transition:
    background-color var(--duration-fast) var(--ease-standard),
    border-color var(--duration-fast) var(--ease-standard),
    transform var(--duration-fast) var(--ease-standard);
}
.mobile-message-action:hover {
  background: color-mix(in oklab, var(--color-muted) 75%, transparent);
}
.mobile-message-action:active {
  transform: translateY(0.5px);
  background: color-mix(in oklab, var(--color-muted) 82%, transparent);
}
.mobile-message-action:disabled {
  opacity: 0.55;
  cursor: not-allowed;
}
.mobile-message-action:disabled:hover,
.mobile-message-action:disabled:active {
  transform: none;
  background: color-mix(in oklab, var(--color-muted) 55%, transparent);
}
.mobile-message-action__icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: 12px;
  background: color-mix(in oklab, var(--color-accent) 20%, var(--color-muted));
  color: var(--color-accent);
  flex-shrink: 0;
}
.mobile-message-action__meta {
  display: flex;
  flex-direction: column;
  gap: 2px;
}
.mobile-message-action__label {
  font-weight: 600;
  font-size: 0.95rem;
}
.mobile-message-action__hint {
  font-size: 0.75rem;
  color: var(--color-fg-muted);
}
.mobile-message-sheet .btn {
  margin-top: var(--space-1);
}
@media (max-width: 640px) {
  .mobile-message-sheet-overlay {
    padding: var(--space-2);
    padding-top: calc(env(safe-area-inset-top) + var(--space-5));
    padding-bottom: calc(env(safe-area-inset-bottom) + var(--space-3));
  }
  .mobile-message-action {
    min-height: 52px;
  }
  .mobile-message-action__icon {
    width: 36px;
    height: 36px;
  }
}
.mobile-model-option {
  width: 100%;
  text-align: left;
  border-radius: 16px;
  padding: var(--space-2) var(--space-3);
  background: color-mix(in oklab, var(--color-surface) 92%, transparent);
  border: 1px solid color-mix(in oklab, var(--color-border) 90%, transparent);
  transition: background-color var(--duration-fast) var(--ease-standard);
}
.mobile-model-option:hover {
  background: color-mix(in oklab, var(--color-muted) 85%, transparent);
}
.mobile-model-option.is-selected {
  border-color: color-mix(in oklab, var(--color-accent) 45%, var(--color-border));
  background: color-mix(in oklab, var(--color-accent) 15%, var(--color-surface));
}
.mobile-menu-item {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  width: 100%;
  border-radius: 14px;
  padding: var(--space-2) var(--space-3);
  background: color-mix(in oklab, var(--color-surface) 95%, transparent);
  border: 1px solid color-mix(in oklab, var(--color-border) 90%, transparent);
  font-weight: 500;
  text-align: left;
  transition: background-color var(--duration-fast) var(--ease-standard);
}
.mobile-menu-item.is-active {
  border-color: color-mix(in oklab, var(--color-accent) 45%, var(--color-border));
  background: color-mix(in oklab, var(--color-accent) 12%, var(--color-surface));
}
.mobile-menu-item:hover {
  background: color-mix(in oklab, var(--color-muted) 80%, transparent);
}
.mobile-menu-item:active {
  transform: translateY(1px);
}
.mobile-menu-item.is-danger {
  border-color: color-mix(in oklab, var(--color-danger) 50%, var(--color-border));
  background: color-mix(in oklab, var(--color-danger) 15%, var(--color-surface));
  color: color-mix(in oklab, var(--color-danger) 70%, var(--color-fg));
}
.dark .mobile-menu-item.is-danger {
  background: color-mix(in oklab, var(--color-danger) 20%, var(--color-muted));
  color: #130c0c;
}
.mobile-theme-item {
  margin-top: var(--space-1);
}

.mobile-menu-popover {
  max-height: min(70vh, 380px);
  overflow-y: auto;
  border-radius: 18px;
  backdrop-filter: var(--glass-saturate) blur(14px);
}

/* Segmented control */
.segmented {
  display: inline-flex;
  align-items: stretch;
  gap: 0;
  border: 1px solid var(--color-border);
  background: color-mix(in oklab, var(--color-muted) 60%, transparent);
  border-radius: 9999px;
  padding: 2px;
}
.segmented .segment:first-child {
  margin-left: 0;
}
.segmented .segment:last-child {
  margin-right: 0;
}
.segment {
  height: 32px;
  min-width: 56px;
  padding: 0 12px;
  border-radius: 9999px;
  background: transparent;
  color: var(--color-fg);
}
.segment:hover {
  background: color-mix(in oklab, var(--color-muted) 70%, transparent);
}
.segment.is-active {
  background: color-mix(in oklab, var(--color-accent) 92%, var(--color-muted));
  color: #0b0b0b;
  box-shadow: inset 0 0 0 1px color-mix(in oklab, #ffffff 25%, var(--color-accent));
}

/* Micro-interactions for segmented control */
.segment {
  transition:
    background-color var(--duration-med) var(--ease-standard),
    color var(--duration-med) var(--ease-standard),
    transform var(--duration-fast) var(--spring-snappy);
}
.segment:active {
  transform: translateY(0.5px);
}

/* Popover */
.popover {
  transform-origin: top right;
  animation: popover-enter 160ms cubic-bezier(0.2, 0.8, 0.2, 1);
}
@keyframes popover-enter {
  from {
    opacity: 0;
    transform: translateY(-6px) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* Menu item */
.menu-item {
  padding: 8px 10px;
  border-radius: 10px;
  cursor: pointer;
}
.menu-item:hover {
  background: var(--color-muted);
}

/* Soft divider for sheet sections */
.soft-divider {
  height: 1px;
  background: color-mix(in oklab, var(--color-border) 85%, transparent);
  margin: var(--space-3) 0;
}

/* Chat list item */
.chat-item {
  cursor: pointer;
  background: color-mix(in oklab, var(--color-surface) 96%, transparent);
  will-change: transform;
}
.chat-item:hover {
  background: color-mix(in oklab, var(--color-muted) 70%, transparent);
}
.chat-item.selected {
  position: relative;
  overflow: hidden; /* clip accent bar to rounded corners */
  background: var(--message-assistant-bg);
  box-shadow: inset 0 0 0 1px var(--message-assistant-border);
}
.chat-item.selected::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--color-accent);
  opacity: 0.6;
}
.chat-item.is-drag-over {
  outline: 2px dashed color-mix(in oklab, var(--color-accent) 60%, var(--color-border));
  outline-offset: 2px;
}

.folder-row {
  border-radius: 18px;
  margin-bottom: var(--space-2);
}
.folder-row.is-drag-over {
  outline: 2px dashed color-mix(in oklab, var(--color-accent) 55%, var(--color-border));
  outline-offset: 2px;
}

/* Subtle lift for cards and pressable buttons */
.card {
  transform: translateY(0);
}
.card:hover {
  transform: translateY(-1px);
}
.pressable {
  transform: translateY(0);
}
.pressable:hover {
  transform: translateY(-1px);
}
.pressable:active {
  transform: translateY(0);
}


/* Traffic lights */
.traffic-lights {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  margin-right: 8px;
}
.traffic-lights .dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 1px solid rgba(0, 0, 0, 0.1);
}
.traffic-lights .close {
  background: #ff5f57;
}
.traffic-lights .min {
  background: #febc2e;
}
.traffic-lights .max {
  background: #28c940;
}

/* Smooth motion defaults */
* {
  transition:
    background-color var(--duration-fast) var(--ease-standard),
    color var(--duration-fast) var(--ease-standard),
    border-color var(--duration-fast) var(--ease-standard),
    box-shadow var(--duration-med) var(--ease-standard),
    transform var(--duration-fast) var(--ease-standard);
}
@media (prefers-reduced-motion: reduce) {
  * {
    transition: none !important;
    animation: none !important;
  }
}

/* Minimal macOS-like scrollbars */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}
::-webkit-scrollbar-track {
  background: transparent;
}
::-webkit-scrollbar-thumb {
  background: color-mix(in oklab, var(--color-fg-muted) 25%, transparent);
  border-radius: 999px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
::-webkit-scrollbar-thumb:hover {
  background: color-mix(in oklab, var(--color-fg-muted) 40%, transparent);
}

/* Sidebar vibrancy */
.sidebar.bg-surface {
  background: var(--glass-panel-bg);
  -webkit-backdrop-filter: var(--glass-saturate) var(--glass-blur-panel);
  backdrop-filter: var(--glass-saturate) var(--glass-blur-panel);
}

/* Ensure the main content scrolls behind a sticky composer */
.content > .flex-1 {
  min-height: 0;
}

/* Composer chrome */
.composer-chrome {
  position: sticky;
  bottom: calc(var(--space-3) + max(0px, env(safe-area-inset-bottom)));
  margin: 0 var(--space-4);
  padding: var(--space-3);
  background:
    radial-gradient(120% 140% at 0% 100%, rgba(120, 100, 255, 0.08), transparent 70%),
    radial-gradient(150% 150% at 100% -10%, rgba(80, 140, 255, 0.05), transparent 65%),
    color-mix(in oklab, var(--glass-panel-bg) 92%, rgba(18, 14, 32, 0.24));
  -webkit-backdrop-filter: var(--glass-saturate) blur(22px);
  backdrop-filter: var(--glass-saturate) blur(22px);
  border: 1px solid color-mix(in oklab, var(--color-border) 70%, rgba(160, 140, 255, 0.25));
  border-radius: 18px;
  box-shadow: 0 18px 36px rgba(24, 18, 60, 0.22);
  /* Allow menus (slash suggestions, reasoning picker) to render outside */
  overflow: visible;
  isolation: isolate;
  z-index: 60; /* keep above drawer content lists by default */
  padding-bottom: calc(var(--space-3) + max(0px, env(safe-area-inset-bottom)));
  transform: translateY(calc(-1 * var(--keyboard-offset, 0px)));
  transition: transform 160ms ease;
}
@media (max-width: 640px) {
  .composer-chrome {
    margin: 0 var(--space-1);
    bottom: calc(var(--space-2) + max(0px, env(safe-area-inset-bottom)));
    padding: var(--space-2);
    padding-bottom: calc(var(--space-2) + max(0px, env(safe-area-inset-bottom)));
    border-radius: 14px;
    box-shadow: 0 16px 32px rgba(24, 18, 60, 0.24);
  }

  .composer-chrome.is-mobile-pinned {
    position: fixed;
    left: var(--space-1);
    right: var(--space-1);
    bottom: calc(var(--space-2) + max(0px, env(safe-area-inset-bottom)));
    /* Keep the same transform logic that lifts it above the keyboard */
    transform: translateY(calc(-1 * var(--keyboard-offset, 0px)));
    z-index: 90;
  }

  html.keyboard-active .composer-chrome {
    margin: 0 var(--space-1);
    transform: translateY(calc(-1 * var(--keyboard-offset, 0px)));
    z-index: 80;
  }

  .composer-placeholder {
    margin: 0 var(--space-1);
    pointer-events: none;
  }

  html.keyboard-active .composer-hero {
    position: sticky;
    bottom: calc(
      var(--space-2) + max(0px, env(safe-area-inset-bottom)) + var(--keyboard-offset, 0px)
    );
    margin: 0 var(--space-1);
    z-index: 70;
  }
}

/* Hero composer (welcome page): centered, non-sticky */
.composer-hero {
  position: relative;
  margin: 0 auto;
  padding: var(--space-3);
  background: var(--glass-panel-bg);
  -webkit-backdrop-filter: var(--glass-saturate) blur(16px);
  backdrop-filter: var(--glass-saturate) blur(16px);
  border: 1px solid var(--color-border);
  border-radius: 18px;
  box-shadow: var(--shadow-card);
  width: min(1120px, calc(100% - var(--space-8)));
  z-index: 60;
}

.tutor-greeting-card {
  position: relative;
  overflow: hidden;
  border-radius: 18px;
  isolation: isolate;
}
.tutor-greeting-card__glow {
  position: absolute;
  inset: -30%;
  background:
    radial-gradient(52% 46% at 14% 22%, rgba(120, 108, 255, 0.22), transparent 70%),
    radial-gradient(60% 60% at 84% 32%, rgba(68, 198, 255, 0.18), transparent 72%),
    radial-gradient(48% 68% at 48% 88%, rgba(255, 196, 140, 0.16), transparent 80%);
  animation: tutor-greeting-pan 12s ease-in-out infinite;
  opacity: 0.7;
  pointer-events: none;
}
.tutor-greeting-card__icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: color-mix(in oklab, var(--color-accent) 18%, transparent);
  border: 1px solid color-mix(in oklab, var(--color-border) 60%, transparent);
  box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--color-accent) 12%, transparent);
}
.tutor-greeting-card__wave-icon {
  width: 16px;
  height: 16px;
  stroke: color-mix(in oklab, var(--color-accent) 80%, white 20%);
  stroke-width: 1.8;
  stroke-linecap: round;
  fill: none;
  transform-origin: 12px 12px;
  animation: tutor-greeting-wave 2.8s ease-in-out infinite;
}
.tutor-greeting-loading {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-3);
  border-radius: 16px;
  border: 1px dashed color-mix(in oklab, var(--color-border) 68%, transparent);
  background: color-mix(in oklab, var(--glass-panel-bg) 86%, transparent);
  box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--color-border) 18%, transparent);
}
.tutor-greeting-loading__spinner {
  width: 34px;
  height: 34px;
  border-radius: 50%;
  border: 3px solid color-mix(in oklab, var(--color-border) 55%, transparent);
  border-top-color: color-mix(in oklab, var(--color-accent) 85%, white 15%);
  animation: tutor-greeting-spin 1.4s cubic-bezier(0.65, 0, 0.35, 1) infinite;
}
.animate-fade-in {
  animation: tutor-greeting-fade 240ms ease-out both;
}

@keyframes tutor-greeting-pan {
  0% {
    transform: translate3d(0, 0, 0) scale(1);
  }
  50% {
    transform: translate3d(4%, -3%, 0) scale(1.05);
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
  }
}
@keyframes tutor-greeting-wave {
  0% {
    transform: rotate(0deg) scale(1);
  }
  50% {
    transform: rotate(10deg) scale(1.05);
  }
  100% {
    transform: rotate(0deg) scale(1);
  }
}
@keyframes tutor-greeting-spin {
  to {
    transform: rotate(360deg);
  }
}
@keyframes tutor-greeting-fade {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Smoother auto-resize for message textarea */
.textarea {
  transition: height 120ms ease;
}


/* Landing gradient similar to blurred GPT hero, but in our palette */
.hero-gradient::before {
  content: '';
  position: absolute;
  inset: -20%;
  background:
    radial-gradient(60% 60% at 50% 40%, rgba(185, 151, 91, 0.25), transparent 60%),
    radial-gradient(40% 40% at 70% 60%, rgba(109, 42, 138, 0.22), transparent 60%),
    radial-gradient(35% 35% at 30% 65%, rgba(212, 175, 55, 0.18), transparent 60%);
  filter: blur(50px);
}

/* Thinking panel effect */
.thinking-panel {
  position: relative;
  border-radius: 18px;
  padding: 16px;
  background: color-mix(in oklab, var(--glass-panel-bg) 85%, var(--color-surface) 15%);
  border: 1px solid color-mix(in oklab, var(--color-border) 78%, transparent);
  box-shadow: var(--shadow-card);
  overflow: hidden;
  backdrop-filter: var(--glass-saturate) blur(18px);
  transition:
    border-color 200ms var(--ease-standard),
    box-shadow 200ms var(--ease-standard);
}
.thinking-panel::before {
  content: '';
  position: absolute;
  inset: 0;
  pointer-events: none;
  background:
    linear-gradient(135deg, rgba(255, 255, 255, 0.24), rgba(255, 255, 255, 0)) top,
    linear-gradient(215deg, rgba(248, 222, 190, 0.16), rgba(199, 206, 255, 0));
  mix-blend-mode: screen;
  opacity: 0.65;
}
@supports not (backdrop-filter: blur(0)) {
  .thinking-panel {
    background: color-mix(in oklab, var(--color-canvas) 60%, rgba(255, 255, 255, 0.4) 40%);
  }
}
.reasoning-shell {
  padding: 0;
}
.reasoning-trigger {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 16px 18px;
  background: transparent;
  border: none;
  color: inherit;
  text-align: left;
  position: relative;
  z-index: 1;
}
.reasoning-trigger:hover,
.reasoning-trigger:focus-visible {
  outline: none;
  background: color-mix(in oklab, rgba(255, 255, 255, 0.16) 70%, transparent);
}
.reasoning-shell.is-streaming .reasoning-trigger {
  cursor: progress;
}
.reasoning-labels {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1;
  min-width: 0;
}
.reasoning-title {
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: color-mix(in oklab, var(--color-foreground) 78%, var(--color-accent) 22%);
}
.reasoning-status {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding-left: 16px;
  font-size: 0.68rem;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: color-mix(in oklab, var(--color-foreground) 68%, transparent);
  opacity: 0.9;
}
.reasoning-status::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: color-mix(in oklab, var(--color-foreground) 55%, transparent);
  transform: translateY(-50%);
  box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.15);
  opacity: 0.6;
}
.reasoning-status.is-live {
  color: color-mix(in oklab, var(--color-accent) 55%, var(--color-foreground) 45%);
  opacity: 1;
}
.reasoning-status.is-live::before {
  background: var(--color-accent);
  opacity: 1;
  animation: reasoning-status-pulse 1.9s ease-in-out infinite;
}
.reasoning-subtitle {
  font-size: 0.82rem;
  color: color-mix(in oklab, var(--color-foreground) 74%, transparent);
}
.reasoning-preview {
  display: flex;
  align-items: center;
  gap: 6px;
  position: relative;
  line-height: 1.45;
  max-width: 100%;
  padding-right: 18px;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.reasoning-preview__text {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}
.reasoning-preview {
  color: color-mix(in oklab, var(--color-foreground) 80%, transparent);
}
.reasoning-preview.is-live {
  color: color-mix(in oklab, var(--color-accent) 45%, var(--color-foreground) 55%);
}
.reasoning-preview.is-live::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    90deg,
    transparent 10%,
    rgba(255, 255, 255, 0.4) 55%,
    transparent 100%
  );
  transform: translateX(-95%);
  animation: reasoning-preview-sheen 2.8s ease-in-out infinite;
  mix-blend-mode: screen;
  pointer-events: none;
}
.reasoning-caret {
  width: 2px;
  height: 1.05em;
  border-radius: 2px;
  background: currentColor;
  flex-shrink: 0;
  margin-bottom: 0.1em;
  animation: reasoning-caret 1s steps(1) infinite;
}
.reasoning-chevron svg {
  transition: transform 220ms var(--ease-standard);
}
.reasoning-shell.is-open .reasoning-chevron svg {
  transform: rotate(180deg);
}
.reasoning-body {
  position: relative;
  padding: 0 18px;
  margin-top: 0;
  border-top: 1px solid color-mix(in oklab, var(--color-border) 75%, transparent);
  max-height: 0;
  opacity: 0;
  overflow: hidden;
  pointer-events: none;
  transition:
    max-height 260ms var(--ease-standard),
    opacity 200ms var(--ease-standard),
    margin-top 200ms var(--ease-standard),
    padding-top 200ms var(--ease-standard),
    padding-bottom 200ms var(--ease-standard);
}
.reasoning-body.is-visible {
  max-height: 420px;
  opacity: 1;
  pointer-events: auto;
  margin-top: 6px;
  padding-top: 16px;
  padding-bottom: 18px;
}
.reasoning-scroll {
  max-height: 300px;
  overflow-y: auto;
  padding-right: 6px;
  scrollbar-width: thin;
}
.reasoning-scroll::-webkit-scrollbar {
  width: 6px;
}
.reasoning-scroll::-webkit-scrollbar-thumb {
  background: color-mix(in oklab, var(--color-border) 85%, transparent);
  border-radius: 999px;
}
.reasoning-text {
  white-space: pre-wrap;
  font-size: 0.88rem;
  line-height: 1.5;
  opacity: 0.92;
}
.reasoning-copy {
  position: absolute;
  top: 14px;
  right: 18px;
  z-index: 2;
}
.reasoning-loader {
  display: grid;
  gap: 7px;
}
.reasoning-loader__bar {
  height: 10px;
  border-radius: 999px;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0.3),
    rgba(141, 115, 68, 0.22),
    rgba(255, 255, 255, 0.34)
  );
  animation: reasoning-loader 1.6s ease-in-out infinite;
}
.reasoning-loader__bar:nth-child(2) {
  animation-delay: 140ms;
}
.reasoning-loader__bar:nth-child(3) {
  animation-delay: 280ms;
}
.reasoning-shell.is-fresh .reasoning-trigger {
  box-shadow: inset 0 0 0 1px color-mix(in oklab, var(--color-accent) 25%, transparent);
}
.reasoning-shell.is-fresh .reasoning-status,
.reasoning-shell.is-fresh .reasoning-subtitle {
  color: color-mix(in oklab, var(--color-accent) 45%, var(--color-foreground) 55%);
}
.thinking-shimmer {
  position: absolute;
  left: -40%;
  top: 0;
  bottom: 0;
  width: 34%;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0),
    rgba(255, 255, 255, 0.06),
    rgba(255, 255, 255, 0)
  );
  animation: thinking-scan 2.4s ease-in-out infinite;
}
/* Subtle animated dot used for loading indicators */
.loading-dot::after {
  content: '';
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: var(--color-accent);
  box-shadow:
    -12px 0 0 color-mix(in oklab, var(--color-accent) 45%, transparent),
    12px 0 0 color-mix(in oklab, var(--color-accent) 45%, transparent);
  animation: loading-dots 1.2s ease-in-out infinite;
}
@keyframes loading-dots {
  0%,
  100% {
    box-shadow:
      -12px 0 0 color-mix(in oklab, var(--color-accent) 45%, transparent),
      12px 0 0 color-mix(in oklab, var(--color-accent) 45%, transparent);
  }
  50% {
    box-shadow:
      0 0 0 color-mix(in oklab, var(--color-accent) 45%, transparent),
      0 0 0 color-mix(in oklab, var(--color-accent) 45%, transparent);
  }
}
@keyframes thinking-scan {
  0% {
    transform: translateX(0%);
    opacity: 0.3;
  }
  50% {
    transform: translateX(220%);
    opacity: 0.7;
  }
  100% {
    transform: translateX(220%);
    opacity: 0;
  }
}
@keyframes reasoning-status-pulse {
  0%,
  100% {
    box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.25);
    transform: translateY(-50%) scale(1);
    opacity: 1;
  }
  50% {
    box-shadow: 0 0 0 7px rgba(255, 255, 255, 0);
    transform: translateY(-50%) scale(1.12);
    opacity: 0.9;
  }
}
@keyframes reasoning-preview-sheen {
  0% {
    transform: translateX(-95%);
    opacity: 0;
  }
  40% {
    opacity: 0.5;
  }
  60% {
    opacity: 0.35;
  }
  100% {
    transform: translateX(110%);
    opacity: 0;
  }
}
@keyframes reasoning-loader {
  0% {
    transform: translateX(-4%);
    opacity: 0.45;
  }
  50% {
    transform: translateX(6%);
    opacity: 0.9;
  }
  100% {
    transform: translateX(-4%);
    opacity: 0.45;
  }
}
@keyframes reasoning-caret {
  0%,
  49% {
    opacity: 1;
  }
  50%,
  100% {
    opacity: 0;
  }
}
@media (prefers-reduced-motion: reduce) {
  .thinking-panel::before,
  .reasoning-status::before,
  .reasoning-preview::after,
  .reasoning-loader__bar,
  .reasoning-caret {
    animation: none !important;
  }
}

.dark .thinking-panel {
  background: color-mix(in oklab, rgba(20, 21, 34, 0.88), var(--color-muted) 18%);
  border-color: color-mix(in oklab, rgba(225, 225, 255, 0.24), var(--color-border));
  box-shadow:
    inset 0 0 0 1px rgba(255, 255, 255, 0.04),
    0 24px 55px -38px rgba(2, 3, 12, 0.8);
}
.dark .thinking-panel::before {
  background:
    linear-gradient(135deg, rgba(93, 123, 255, 0.28), rgba(30, 42, 70, 0)) top,
    linear-gradient(215deg, rgba(121, 91, 205, 0.24), rgba(22, 29, 52, 0));
  opacity: 0.55;
}
.dark .reasoning-subtitle {
  color: color-mix(in oklab, rgba(226, 232, 240, 0.82) 80%, transparent);
}
.dark .reasoning-loader__bar {
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0.24),
    rgba(94, 153, 255, 0.28),
    rgba(255, 255, 255, 0.22)
  );
}
.dark .reasoning-preview {
  color: color-mix(in oklab, rgba(226, 232, 240, 0.82) 75%, transparent);
}
.dark .reasoning-preview.is-live {
  color: color-mix(in oklab, rgba(148, 197, 255, 0.7), rgba(226, 232, 240, 0.82));
}
.dark .reasoning-preview.is-live::after {
  background: linear-gradient(
    90deg,
    transparent 10%,
    rgba(148, 197, 255, 0.32) 55%,
    transparent 100%
  );
}
.dark .reasoning-status {
  color: color-mix(in oklab, rgba(226, 232, 240, 0.82) 65%, transparent);
}
.dark .reasoning-status::before {
  background: color-mix(in oklab, rgba(226, 232, 240, 0.82) 80%, transparent);
  box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.08);
}
.dark .reasoning-status.is-live {
  color: color-mix(in oklab, rgba(148, 197, 255, 0.88) 70%, rgba(226, 232, 240, 0.82) 30%);
}

/* Tutor UI: answer micro pop animation */
.answer-pop {
  animation: answer-pop 140ms var(--spring-snappy);
}
@keyframes answer-pop {
  from {
    transform: scale(0.98);
  }
  to {
    transform: scale(1);
  }
}

/* Tutor UI: Flashcard flip */
.flashcard {
  perspective: 1000px;
}
.flashcard-inner {
  position: relative;
  transition: transform 400ms var(--ease-standard);
  transform-style: preserve-3d;
}
.flashcard.is-flipped .flashcard-inner {
  transform: rotateY(180deg);
}
.flashcard-face {
  position: relative;
  backface-visibility: hidden;
}
.flashcard-back {
  transform: rotateY(180deg);
}

/* Markdown typography */
.markdown {
  line-height: 1.65;
  word-wrap: break-word;
  overflow-wrap: anywhere;
}
.markdown p {
  margin: 0.5rem 0 0.75rem;
}
.markdown h1,
.markdown h2,
.markdown h3,
.markdown h4,
.markdown h5,
.markdown h6 {
  font-weight: 700;
  line-height: 1.25;
  margin: 1.2rem 0 0.6rem;
}
.markdown h1 {
  font-size: 1.6rem;
}
.markdown h2 {
  font-size: 1.35rem;
}
.markdown h3 {
  font-size: 1.15rem;
}
.markdown h4 {
  font-size: 1.05rem;
}
.markdown h5,
.markdown h6 {
  font-size: 1rem;
}
.markdown ul,
.markdown ol {
  margin: 0.5rem 0 0.9rem 1.35rem;
}
.markdown ul {
  /* Tailwind preflight removes list styles; restore for markdown */
  list-style: disc;
}
.markdown ol {
  list-style: decimal;
}
.markdown li::marker {
  color: var(--color-fg-muted);
}
.markdown ul ul {
  list-style: circle;
  margin-top: 0.25rem;
  margin-bottom: 0.25rem;
}
.markdown ul ul ul {
  list-style: square;
}
.markdown ol ol {
  list-style: lower-alpha;
}
.markdown ol ol ol {
  list-style: lower-roman;
}
.markdown li > p {
  /* Avoid extra gaps for paragraphs inside list items */
  margin: 0.15rem 0;
}
/* GitHub-style task lists (remark-gfm) */
.markdown .task-list-item {
  list-style: none; /* remove default bullet when checkbox is present */
}
.markdown .contains-task-list {
  margin-left: 0.75rem; /* align with checkbox */
}
.markdown input[type='checkbox'] {
  accent-color: var(--color-accent);
  margin-right: 0.5rem;
  transform: translateY(1px);
  pointer-events: none; /* keep static in chat */
}
.markdown li {
  margin: 0.2rem 0;
}
.markdown blockquote {
  margin: 0.9rem 0;
  padding: 0.35rem 0.9rem;
  border-left: 3px solid var(--color-border);
  color: var(--color-fg-muted);
  background: color-mix(in oklab, var(--color-muted) 60%, transparent);
  border-radius: 8px;
}
.markdown hr {
  border: none;
  border-top: 1px solid var(--color-border);
  margin: 1rem 0;
}
.markdown code {
  background: var(--color-muted);
  border: 1px solid var(--color-border);
  border-radius: 8px;
  padding: 0.1rem 0.35rem;
}
.markdown kbd {
  font-family: var(--font-mono);
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-bottom-width: 2px;
  border-radius: 6px;
  padding: 0 0.3rem;
  font-size: 0.85em;
}
.markdown pre {
  position: relative;
}
.markdown pre code {
  background: transparent;
  border: none;
  padding: 0;
}
.markdown pre[data-wrap='true'] {
  white-space: pre-wrap;
  word-break: break-word;
}
.markdown pre[data-wrap='false'] {
  white-space: pre;
}
.markdown table {
  width: 100%;
  border-collapse: collapse;
  margin: 0.75rem 0;
  font-size: 0.95em;
}
.markdown thead th {
  text-align: left;
  color: var(--color-fg-muted);
  border-bottom: 1px solid var(--color-border);
  padding: 6px 8px;
}
.markdown tbody td {
  border-top: 1px solid var(--color-border);
  padding: 6px 8px;
}
.markdown img {
  max-width: 100%;
  border-radius: 10px;
}
.markdown .footnotes {
  font-size: 0.9em;
  color: var(--color-fg-muted);
}

/* Heading anchors (rehype-slug + autolink) */
.markdown .heading-anchor {
  color: inherit;
  text-decoration: none;
}
.markdown .heading-anchor:hover {
  text-decoration: underline;
  text-decoration-style: dotted;
}

/* Pre toolbar container gets a subtle backdrop to separate from code */
.pre-toolbar {
  pointer-events: none; /* let buttons be clickable only */
}
.pre-toolbar > * {
  pointer-events: auto;
}

/* Fading mask when content is clipped */
.pre-fade {
  position: sticky;
  bottom: -1px;
  left: 0;
  right: 0;
  height: 48px;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0), var(--color-muted));
}

/* Mermaid diagram container */
.mermaid-diagram {
  background: var(--color-muted);
  border: 1px solid var(--color-border);
  border-radius: 14px;
  padding: 12px;
  overflow: auto;
}

/* PrismJS syntax highlighting (colors only; layout handled by components) */
/* Token color variables for light mode */
:root {
  --syntax-comment: #6a737d;
  --syntax-punctuation: var(--color-fg-muted);
  --syntax-keyword: var(--color-accent-2);
  --syntax-string: #22863a;
  --syntax-function: #005cc5;
  --syntax-number: #0b63c8;
  --syntax-operator: color-mix(in oklab, var(--color-accent) 60%, #444);
  --syntax-property: #0b63c8;
  --syntax-class: #6f42c1;
  --syntax-variable: #e36209;
  --syntax-regex: #e36209;
}
/* Token color variables for dark mode */
.dark {
  --syntax-comment: #8b949e;
  --syntax-punctuation: #c9d1d9;
  --syntax-keyword: #c38fff; /* purple-ish for keywords */
  --syntax-string: #7ee787; /* green */
  --syntax-function: #d2a8ff; /* purple */
  --syntax-number: #79c0ff; /* blue */
  --syntax-operator: #e3b341; /* gold */
  --syntax-property: #7aa2f7; /* blue */
  --syntax-class: #d2a8ff;
  --syntax-variable: #ffa657; /* orange */
  --syntax-regex: #ffab70;
}

/* Apply token colors within rendered markdown only */
.markdown code[class*='language-'],
.markdown pre[class*='language-'] {
  text-shadow: none;
}
.markdown .token.comment,
.markdown .token.prolog,
.markdown .token.doctype,
.markdown .token.cdata {
  color: var(--syntax-comment);
}
.markdown .token.punctuation {
  color: var(--syntax-punctuation);
}
.markdown .token.property,
.markdown .token.tag,
.markdown .token.constant,
.markdown .token.symbol,
.markdown .token.deleted {
  color: var(--syntax-property);
}
.markdown .token.boolean,
.markdown .token.number {
  color: var(--syntax-number);
}
.markdown .token.selector,
.markdown .token.attr-name,
.markdown .token.string,
.markdown .token.char,
.markdown .token.builtin,
.markdown .token.inserted {
  color: var(--syntax-string);
}
.markdown .token.operator,
.markdown .token.entity,
.markdown .token.url {
  color: var(--syntax-operator);
}
.markdown .token.atrule,
.markdown .token.keyword {
  color: var(--syntax-keyword);
}
.markdown .token.function {
  color: var(--syntax-function);
}
.markdown .token.class-name {
  color: var(--syntax-class);
}
.markdown .token.regex,
.markdown .token.important,
.markdown .token.variable {
  color: var(--syntax-regex);
}
.markdown .token.bold {
  font-weight: 700;
}
.markdown .token.italic {
  font-style: italic;
}
